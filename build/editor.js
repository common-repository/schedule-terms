(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,r=window.wp.plugins,n=window.wp.data,o=window.wp.coreData,a=window.wp.editor,l=window.wp.editPost,s=window.wp.element,m=window.wp.i18n,i=window.wp.primitives,c=(0,t.createElement)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,t.createElement)(i.Path,{d:"M12 13.06l3.712 3.713 1.061-1.06L13.061 12l3.712-3.712-1.06-1.06L12 10.938 8.288 7.227l-1.061 1.06L10.939 12l-3.712 3.712 1.06 1.061L12 13.061z"})),p=window.wp.components,u=window.wp.date,d=window.moment;var w=e.n(d);const g=({term:e,taxonomy:r,label:n,postType:a,type:l})=>{const[i,d]=(0,o.useEntityProp)("postType",a,"meta"),g=(0,s.useRef)(),y=(0,u.getSettings)(),[_=y?.formats.date]=(0,o.useEntityProp)("root","site","date_format"),[E=y?.formats.time]=(0,o.useEntityProp)("root","site","time_format"),h=/a(?!\\)/i.test(E.toLowerCase().replace(/\\\\/g,"").split("").reverse().join("")),f=()=>{const{timezone:e}=y,[t,r]=e.offset.toString().split(".");return`${Number(t)>0?"+":"-"}${String(Math.abs(Number(t))).padStart(2,"0")}:${String(Math.floor(60*Number(`0.${r||0}`))).padStart(2,"0")}`},v=t=>{const n=i?.schedule_terms?.filter((t=>!(t.term===e&&t.type===l&&t.taxonomy===r)))||[];d({...i,schedule_terms:[...n,t?{term:e,taxonomy:r,type:l,datetime:w()(`${t}${f()}`).utc().format()}:null].filter((e=>null!==e))})},x=((t="YYYY-MM-DDTHH:mm:ss")=>{const n=i?.schedule_terms?.find((t=>t.term===e&&t.type===l&&t.taxonomy===r));if(n?.datetime)return w()(n.datetime).utcOffset(f()).format(t)})();return(0,t.createElement)(p.PanelRow,{ref:g},(0,t.createElement)("span",null,n),(0,t.createElement)(p.Dropdown,{popoverProps:{anchorRef:g.current},renderToggle:({onToggle:e,isOpen:r})=>(0,t.createElement)(t.Fragment,null,(0,t.createElement)(p.Button,{onClick:e,"aria-expanded":r,variant:"tertiary"},x?(0,u.dateI18n)(`${_} ${E}`,x):(0,m.__)("none","schedule-terms"))),renderContent:({onClose:e})=>(0,t.createElement)("div",{style:{padding:8}},(0,t.createElement)("div",{style:{marginBottom:"1em"}},(0,t.createElement)(p.__experimentalHStack,null,(0,t.createElement)(p.__experimentalHeading,{level:2,size:13},n),(0,t.createElement)(p.__experimentalSpacer,null),(0,t.createElement)(p.Button,{className:"block-editor-inspector-popover-header__action",label:(0,m.__)("Close"),icon:c,onClick:e}))),(0,t.createElement)(p.DateTimePicker,{is12Hour:h,currentDate:x,onChange:e=>v(e)}),(0,t.createElement)("div",{style:{marginTop:"1em"}},(0,t.createElement)(p.Button,{variant:"secondary",onClick:()=>v(null)},(0,m.__)("Reset","schedule-terms"))))}))},y=({taxonomies:e,terms:r,currentPostType:n})=>(0,t.createElement)("div",null,e?.map((e=>(0,t.createElement)("div",{key:e.slug},r[e.slug]&&r[e.slug].length>0&&r[e.slug]?.map((r=>(0,t.createElement)("div",{key:r.id},(0,t.createElement)("h4",null,e.name,": ",r.name),(0,t.createElement)(g,{label:(0,m.__)("Attach","schedule-terms"),term:r.slug,taxonomy:e.slug,type:"attach",postType:n}),(0,t.createElement)(g,{label:(0,m.__)("Detach","schedule-terms"),term:r.slug,taxonomy:e.slug,type:"detach",postType:n}))))))));(0,r.registerPlugin)("schedule-terms",{render:()=>{const{postType:e,taxonomies:r,terms:s}=(0,n.useSelect)((e=>{const{getTaxonomies:t,getEntityRecords:r}=e(o.store),n=e(a.store).getCurrentPostType(),l=(t({per_page:-1})||[]).filter((e=>e.types.includes(n))),s=Object.fromEntries(l.map((e=>{const t=r("taxonomy",e.slug,{per_page:-1})?.filter((({meta:{schedule_terms_active:e}})=>e));return[e.slug,t]})));return{postType:n,taxonomies:l,terms:s}}));return(0,t.createElement)(l.PluginDocumentSettingPanel,{name:"schedule-terms",title:(0,m.__)("Schedule Terms","schedule-terms"),className:"schedule-terms"},(0,t.createElement)(y,{currentPostType:e,taxonomies:r,terms:s}))},icon:"clock"})})();